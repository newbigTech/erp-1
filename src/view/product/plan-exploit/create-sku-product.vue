<template>
    <page-dialog class="p-create-product" :title="status"
                 @open="open"
                 v-model="visible" size="large" :close-on-click-modal="false">
        <!--<base-info  ref="baseInfo"-->
                    <!--v-model="visible"-->
                    <!--:selectProduct="selectProduct"-->
                    <!--:isEdit="isEdit" :id="id"-->
                    <!--:isComplete="isComplete"-->
                    <!--:isDispose="isDispose"-->
                    <!--:disposeBtn="disposeBtn"-->
                    <!--:fromData="fromData"-->
                    <!--:isCreate = "isCreate"-->
                    <!--@add-good="add_good"-->
                    <!--@dispose-goods="add_good"-->
                    <!--@edit-product="edit_product"-->
                    <!--@visible-hide="visible=false"-->
        <!--&gt;</base-info>-->
        <base-info-copy ref="baseInfo" :form-data="formData"></base-info-copy>
        <div slot="footer">
            <el-button type="primary" size="mini" class="inline">保存</el-button>
            <el-button type="primary" size="mini" class="inline">提交审核</el-button>
            <el-button type="primary" size="mini" class="inline">取消</el-button>
            <el-button type="primary" size="mini" class="inline">审核通过</el-button>
            <el-button type="primary" size="mini" class="inline">作废</el-button>
        </div>
    </page-dialog>
</template>
<script>
    import {publish_edit_plat} from  '@/api/product-library';
    import {api_save_goods,api_get_channel} from '@/api/created-product';
    export default{
        data(){
            return {
                visible:false,
                formData:{
                    plat:[],
                    category_id:[],
                    dev_platform:'',
                    platform:[],
                    title:'',
                    brand_id:'',
                    tort_id:'',
                    purchase_price:'',
                    lowest_sale_price:'',
                    competitor_price:'',
                    advice_price:'',
                    gross_profit:'',
                    auth_book:'',
                    thumb:[],
                    weight:'',
                    source_url:'',
                    purchase_url:[''],
                    platform_sale:[],
                    description:'',
                    audit:'',
                },
            }
        },
        mounted(){

        },
        methods:{
            /*创建时使用，获取平台*/
            get_chennel(){
                return this.$http(api_get_channel).then(res=>{
                    return Promise.resolve(res)
                })
            },
            /*创建时使用，获取平台状态*/
            init_platlist(){
                this.get_chennel().then(res=>{
                    this.formData.platform_sale = res.map(row=>{
                        return {
                            name:row.label,
                            id:row.value
                        }
                    });
                    this.$http(publish_edit_plat).then(res=>{
                        this.formData.plat = res;
                        this.formData.platform_sale = this.formData.platform_sale.map(val=>{
                            this.$set(val,'value','可选上架');
                            this.$set(val,'value_id',1);
                            return val
                        })
                        console.log(this.formData.platform_sale,'this.formData.platform_sale');
                    }).catch(code=>{
                        console.log(code,'code');
                    })
                })
            },
            edit_product(){
                this.visible = false;
                this.$emit('edit-product')
            },
            add_good(val,id){
                this.visible = false;
                this.$emit('update-product',val,id)
            },
            open(){
                this.init_platlist();
            },
        },
        watch: {
            visible(val){
                this.$emit('input', val);
            },
            value(val){
                this.visible = val;
            }
        },
        props: {
            value: {},
            isEdit: {},
            status:{}
        },
        components: {
            baseInfo: require('./base-info.vue').default,
            pageDialog: require("../../../components/page-dialog.vue").default,
            baseInfoCopy: require('./base-info-copy.vue').default,
        }
    }
</script>

