<template>
    <page-dialog title="新建开发产品" v-model="visible"
                 @open="open"
                 size="small" :close-on-click-modal="false">
      <div style="padding: 10px;">
        <mui-select :parent="0" :select="muiSelects" @selected="select_product"></mui-select>
      </div>
        <div style="text-align: right">
          <el-button type="primary" size="mini" :disabled="isNext" @click="next">选择并继续下一步</el-button>
          <el-button size="mini" @click="visible=false">关闭</el-button>
        </div>
    </page-dialog>
</template>

<style lang="stylus">

</style>
<script>
    import {api_get_categories} from   '../../../api/categories';
    export default{
        data(){
            return {
              visible:false,
              muiSelects:{},
              isNext:true,
              selectProduct:{}
            }
        },
        filters: {},
        mounted(){
          this.init();
        },
        methods: {
            open(){
                this.isNext = true;
            },
            init(){
              this.$http(api_get_categories).then(data=>{
                this.muiSelects=data;
              }).catch(code=>{
                this.$message({
                    type:"error",
                    message:code.message || code
                })
              });
            },
            get_title(){
              if (!this.muiSelects[this.selectProduct.value]) {
                return "";
              }
              let name = this.muiSelects[this.selectProduct.value].parents.map(parent=> {
                return this.muiSelects[parent].title;
              });
              name.push(this.muiSelects[this.selectProduct.value].title);
              this.$set(this.selectProduct,'title', name.join(">>"));
            },
            select_product(val){
              this.selectProduct = val;
              this.isNext = false;
            },
            next(){
              this.$emit('select-product',this.selectProduct);
              this.get_title();
              this.visible = false;

            }
        },
        computed: {},
        watch: {
          visible(val){
            this.$emit('input', val);
          },
          value(val){
            this.visible = val;
          }
        },
        props: {
          value:{}
        },
        components: {
          pageDialog: require("../../../components/page-dialog.vue").default,
          muiSelect: require("../../../components/mui-select.vue").default
        }
    }
</script>

