<template>
    <search-card @search="search"
                 @enter="search"
                 :params="searchData"
                 :clears="clears">
        <label-buttons class="inline" :buttons="flowBtns"
                       @select="select_flow_path" label="开发流程："
                       :max="40" :labelWidth="60"></label-buttons>
        <br>
        <label-item :labelWidth="60" label="申请人：" class="inline">
            <el-select class="inline s-width-small"
                       v-model="searchData.create_id"
                       filterable clearable default-first-option>
                <el-option v-for="item in proposer"
                           :value="item.value"
                           :label="item.label"
                           :key="item.value"></el-option>
            </el-select>
        </label-item>
        <el-select class="ml-sm inline s-width-small"
                   v-model="searchData.search_key">
            <el-option v-for="item in accountType"
                       :value="item.value"
                       :key="item.value"
                       :label="item.label"></el-option>
        </el-select>
        <el-input class="inline enter-result"
                  v-model="searchData.search_val"
                  :placeholder="`请输入${changeLabel}...`"></el-input>
        <label class="ml-sm">申请时间：</label>
        <el-date-picker class="date inline"
                        v-model="searchData.create_time_start"
                        :picker-options="inputTimeStart"
                        placeholder="开始时间"></el-date-picker>
        <span>--</span>
        <el-date-picker class="date inline mr-sm"
                        v-model="searchData.create_time_end"
                        :picker-options="inputTimeEnd"
                        placeholder="结束时间"></el-date-picker>
    </search-card>
</template>
<style lang="stylus">

</style>
<script>
    import {api_processbtn} from '@/api/product';
    import {api_goods_process,api_product_person} from '@/api/plan-exploit'
    export default{
        data(){
            return{
                flowBtns:[],
                proposer: [],
                accountType: [
                    {label: "流程编号", value: 'code'},
                    {label: "产品名称", value: 'title'}
                ],
                inputTimeStart: {
                    disabledDate: (time) => {
                        if (this.searchData.create_time_end) {
                            return time.getTime() > this.searchData.create_time_end;
                        } else {
                            return false
                        }
                    }
                },
                inputTimeEnd: {
                    disabledDate: (time) => {
                        if (this.searchData.create_time_start) {
                            return time.getTime() < this.searchData.create_time_start;
                        } else {
                            return false
                        }
                    }
                }
            }
        },
        mounted(){
            this.api_processbtn();
            this.get_proposer();
        },
        methods:{
            search(){
                this.$emit('search');
            },
            api_processbtn(){
                this.$http(api_goods_process).then(res => {
                    this.flowBtns = res.map(row => {
                        return {
                            name: row.title,
                            value: row.process_id
                        }
                    })
                });
            },
            get_proposer(){
                this.$http(api_product_person).then(res => {
                    let arr = res.map(row => {
                        return {
                            label: row.realname,
                            value: row.id
                        }
                    });
                    this.proposer = [{label: '全部', value: ''}, ...arr];
                })
            },
            select_flow_path(index){
                //查询事件
                this.searchData.process_id = this.flowBtns[index].value;
                this.$emit('click-button')
            }
        },
        computed:{
            changeLabel(){
                if(this.searchData.search_key === 'code'){
                    return `流程编号`;
                }else{
                    return `产品名称`;
                }
            }
        },
        props:{
            searchData:{},
            clears:{},
        },
        components:{
            searchCard:require('@/components/search-card.vue').default,
            labelItem:require('@/components/label-item.vue').default,
            labelButtons:require('@/components/label-buttons.vue').default,
        }
    }
</script>